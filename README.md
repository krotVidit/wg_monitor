# wg_monitor


**wg_monitor** — это инструмент для удобного удалённого мониторинга серверов через SSH.  
Он позволяет выполнять заранее настроенные команды на сервере и отображать результаты в удобном CLI-интерфейсе. Проект особенно полезен для работы с WireGuard (wg), но также поддерживает другие системные команды.

---

## Возможности

- Подключение к удалённому серверу по SSH с использованием приватного ключа.
- Выполнение любых команд, заданных в `commands.json`.
- CLI с цветовой разметкой для удобства чтения.
- Постоянная работа в интерактивном режиме с возможностью выбора команды.
- Быстрый просмотр состояния WireGuard, свободной памяти, диска, журналов и внешнего IP.

---

## Установка
1. Клонируйте репозиторий:

```bash
git clone https://github.com/krotVidit/wg_monitor.git
cd wg_monitor
```
2.Установите зависимости:
```bash
go mod tidy
```
3.Создайте файл конфигурации `config.json` в корне проекта
По примеру:
```json
{
  "user": "root",    
  "host": "Адресс хоста",
  "port": 22, 
  "private_key_path": "Путь до приватного ключа на машине",
  "know_host": "Путь до списка подключенных хостов"
}
```
## Запуск 
После настройки `config.json` и установки зависимостей, программу можно запустить двумя способами:

### 1️⃣ Через Go (без сборки):
⚠️ Требуется установленный Go
```bash
go run main.go
```
2️⃣ Через собранный бинарник:

⚠️ После сборки рядом с бинарником должен лежать `config.json` и `command.json`

  - Собираем Бинарник
```bash
go build -o wg_monitor ./main.go
```
  - Запускаем Бинарник 
```bash
./wg_monitor
```

## Команды для запуска в `commands.json`

Программа позволяет выполнять любые команды на удалённом сервере, которые указаны в файле `commands.json`.  
Вы можете добавлять свои команды или изменять существующие, главное — чтобы ключи в JSON были уникальными, а значения — корректными shell-командами.

### Стандартные команды, которые идут по умолчанию:

| Ключ       | Описание                                                                 |
|------------|--------------------------------------------------------------------------|
| `wg`       | Показывает состояние всех интерфейсов WireGuard, кто подключён и когда. |
| `free`     | Выводит информацию о памяти (свободная, занятая).                       |
| `df`       | Проверка использования дисков.                                           |
| `journal`  | Просмотр критических логов системы (журналы с уровнем ошибки ≥3).        |
| `curl`     | Получение внешнего IP сервера через ipinfo.io.                           |
| `ping`     | Проверка доступности внешнего сервиса (по умолчанию google.com).        |

### Пример `commands.json`:

```json
{
  "wg": "sudo wg show all dump | awk -v now=\"$(date +%s)\" '$6 != 0 && (now - $6) < 180 {print $1, $4, $5, strftime(\"%H:%M:%S\", $6)}'",
  "free": "free -h",
  "df": "df -h",
  "journal": "sudo journalctl -b -p 3",
  "curl": "curl -s https://ipinfo.io",
  "ping": "ping -c 5 -q google.com"
}
```
## Структура проекта
```bash
├── commands.json
├── config.json
├── .gitignore
├── go.mod
├── go.sum
├── internal
│   ├── command
│   │   ├── loadCommand.go
│   │   ├── runCommand.go
│   │   └── service.go
│   ├── connect
│   │   ├── service.go
│   │   ├── signer.go
│   │   └── ssh.go
│   ├── domain
│   │   └── config.go
│   ├── runner
│   │   ├── interface.go
│   │   └── run.go
│   └── ui
│       ├── cli.go
│       ├── color.go
│       └── service.go
├── main.go
└── README.md
```

